# Low-Rank Matrix Completion Experiments (MovieLens 10M & 20M)

## ğŸ“ æ ¸å¿ƒæ•°å­¦æ¨¡å‹ (Mathematical Model)

æœ¬é¡¹ç›®ä¸­çŸ©é˜µåˆ†è§£ï¼ˆMatrix Factorizationï¼‰çš„æ ¸å¿ƒä¼˜åŒ–ç›®æ ‡å¦‚ä¸‹ï¼š

$$
\min_{U,V,b_u,b_i} \sum_{(u,i)\in\Omega} \left(r_{ui} - \mu - b_u - b_i - U_u^\top V_i\right)^2 + \lambda \left(\|U\|_F^2 + \|V\|_F^2 + \|b_u\|_2^2 + \|b_i\|_2^2\right)
$$

**å…¬å¼å«ä¹‰è¯´æ˜ï¼š**

*   **$\Omega$**: è§‚æµ‹åˆ°çš„è¯„åˆ†é›†åˆ (ç”¨æˆ·, ç‰©å“)ã€‚
*   **$r_{ui}$**: ç”¨æˆ· $u$ å¯¹ç‰©å“ $i$ çš„çœŸå®è¯„åˆ†ã€‚
*   **$\mu$**: å…¨å±€å¹³å‡è¯„åˆ† (Global Bias)ã€‚
*   **$b_u, b_i$**: ç”¨æˆ·åç½®é¡¹ä¸ç‰©å“åç½®é¡¹ï¼Œç”¨äºæ•æ‰ä¸ªä½“å·®å¼‚ã€‚
*   **$U_u, V_i$**: ç”¨æˆ·ä¸ç‰©å“çš„ $k$ ç»´éšå‘é‡ (Latent Vectors)ï¼Œ$U_u^\top V_i$ æ‹Ÿåˆäº¤äº’åˆ†æ•°ã€‚
*   **$\lambda$**: æ­£åˆ™åŒ–ç³»æ•°ï¼Œç”¨äºçº¦æŸå‚æ•°èŒƒæ•°ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚

---

# Part 1: HW2 - Low-Rank Matrix Completion on MovieLens-10M

## ğŸ“Œ é¡¹ç›®æ¦‚è§ˆ
- **æ•°æ®**ï¼šMovieLens 20M çš„ 10M å­é›†ï¼Œ5 æŠ˜äº¤å‰éªŒè¯ï¼ˆseed=0ï¼‰ã€‚
- **ç›®æ ‡**ï¼šæ¯”è¾ƒå‡¸æ–¹æ³•ä¸è‡³å°‘ä¸€ç§éå‡¸ä½ç§©çŸ©é˜µå¡«å……æ–¹æ³•ï¼Œè¯„ä»·æŒ‡æ ‡ä¸º RMSEã€‚
- **äº§å‡º**ï¼šRMSE æ˜ç»†è¡¨ä¸æŸ±çŠ¶å›¾ã€æ”¶æ•›æ›²çº¿ã€rank æ‰«ææ›²çº¿ã€å¤ç°å®éªŒè„šæœ¬ã€‚

## ğŸ“Š æ•°æ®ä¸åˆ’åˆ†
- **ç»Ÿè®¡**ï¼š`n_users=69878`ï¼Œ`n_items=10677`ï¼Œ`n_ratings=10000054`ï¼Œ`k=5`ï¼Œ`seed=0`ã€‚
- **åˆ’åˆ†æ–¹æ³•**ï¼šå¯¹é”® `seed:uid:mid:ts` åš blake2b å“ˆå¸Œå¹¶å¯¹ k å–æ¨¡ï¼Œä¿è¯æ¯æ¡è¯„åˆ†å”¯ä¸€è½å…¥æŸæŠ˜ï¼›ç”¨æˆ·/ç‰©å“é‡æ˜ å°„ä¸ºç¨ å¯†ç´¢å¼•ã€‚
- **ç†è®ºæ”¯æ’‘**ï¼šå“ˆå¸Œåˆ†æŠ˜è¿‘ä¼¼å‡åŒ€éšæœºåˆ’åˆ†ï¼Œå‡å°äººä¸ºåç½®ï¼›ç¨ å¯†æ˜ å°„ä¾¿äºç¨€ç–çŸ©é˜µè¿ç®—ã€‚

## âš™ï¸ è®­ç»ƒä¸ä¸»è¦å‚æ•°
- **é€šç”¨**ï¼š`device=cuda`ï¼Œ`batch_size=131072`ï¼Œ`seed=42`ã€‚
- **éå‡¸ MF**ï¼š`rank_mf=64`ï¼Œ`epochs_mf=30`ï¼Œ`lr_mfâ‰ˆ0.02`ï¼Œ`reg_mf=0.02`ï¼Œ`reg_bias=0.005`ã€‚
- **PGD/æ‰°åŠ¨/è°±åˆå§‹åŒ–**ï¼š`rank_pgd=32`ï¼Œ`iters_pgd=30`ï¼Œ`eta_pgd=0.2`ã€‚
- **å‡¸æ–¹æ³•ï¼ˆæ ¸/è¿¹èŒƒæ•°ï¼‰**ï¼š
    - `rank_cvx=32`ï¼Œ`iters_softimpute=30`ï¼Œ`lam_softimpute=0.5`
    - `iters_ista=30`ï¼Œ`lam_ista=0.5`ï¼Œ`eta_ista=0.1`
    - `iters_fista=30`ï¼Œ`lam_fista=0.5`ï¼Œ`eta_fista=0.1`
    - `iters_fw=30`ï¼Œ`tau_fw=50`

## ğŸ§  ç®—æ³•å®ç° (Implemented Algorithms)

### ğŸ“‰ éå‡¸æ–¹æ³• (Non-Convex / Factorization)
> ç›´æ¥å¯¹ä½ç§©å› å­ $U, V$ è¿›è¡Œä¼˜åŒ–ï¼Œè®¡ç®—æ•ˆç‡é«˜ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®ã€‚

*   **åŸºç¡€åˆ†è§£ç±»**
    *   **`nc_mf_sgd`**: æ ‡å‡†çŸ©é˜µåˆ†è§£ï¼ˆå¸¦ $b_u, b_i$ åç½®ï¼‰ï¼Œä½¿ç”¨ SGD/Adam ä¼˜åŒ–ã€‚
    *   **`nc_mf_nobias`**: æ— åç½®çŸ©é˜µåˆ†è§£ï¼Œä»…ä¿ç•™æ ¸å¿ƒäº¤äº’é¡¹ï¼Œç”¨äºçº¯ç²¹çš„ç§©åˆ†æã€‚
*   **äº¤æ›¿æ›´æ–°ä¸åˆå§‹åŒ–**
    *   **`nc_alt_block`**: äº¤æ›¿æœ€å°äºŒä¹˜ (ALS) é£æ ¼çš„å—æ›´æ–°ç­–ç•¥ã€‚
    *   **`nc_spec_alt`**: **ä¸¤é˜¶æ®µæ³•**ã€‚å…ˆä½¿ç”¨**è°±åˆå§‹åŒ– (Spectral Init)** å¯»æ‰¾ä¼˜è´¨èµ·ç‚¹ï¼Œå†è¿›è¡Œäº¤æ›¿ä¼˜åŒ–ï¼Œæ”¶æ•›æ›´ç¨³ã€‚
*   **ä¼˜åŒ–æ™¯è§‚æ¢ç´¢ (Landscape)**
    *   **`nc_perturb`**: æ‰°åŠ¨æ¢¯åº¦ä¸‹é™ã€‚åœ¨æŸå¤±å¹³å°æœŸæ·»åŠ éšæœºå™ªå£°ï¼Œè¾…åŠ©æ¨¡å‹**è·³å‡ºéç‚¹**ã€‚
    *   **`nc_pgd_rankk`**: æŠ•å½±æ¢¯åº¦ä¸‹é™ (PGD)ã€‚æ¢¯åº¦æ­¥åæ‰§è¡Œæˆªæ–­ SVDï¼Œæ˜¾å¼å¼ºåˆ¶ $\text{rank}(X) \le k$ã€‚

### ğŸ”® å‡¸æ–¹æ³• (Convex / Nuclear Norm)
> ä½¿ç”¨æ ¸èŒƒæ•° $\|X\|_*$ ä½œä¸ºç§©çš„å‡¸æ¾å¼›ï¼Œç†è®ºä¸Šä¿è¯å…¨å±€æœ€ä¼˜ã€‚

*   **`c_softimpute`**: **Soft-Impute**ã€‚ç»å…¸çš„â€œå¡«å……+SVTâ€è¿­ä»£ï¼Œé€šè¿‡å¥‡å¼‚å€¼è½¯é˜ˆå€¼ç®—å­æ±‚è§£ã€‚
*   **`c_ista_nuc` / `c_fista_nuc`**: è¿‘ç«¯æ¢¯åº¦ä¸‹é™åŠå…¶åŠ é€Ÿç‰ˆ (FISTA)ã€‚ç»“åˆäº†æ¢¯åº¦ä¸‹é™ä¸è½¯é˜ˆå€¼æŠ•å½±ï¼ŒFISTA åˆ©ç”¨åŠ¨é‡åŠ é€Ÿæ”¶æ•›ã€‚
*   **`c_fw_trace`**: **Frank-Wolfe** ç®—æ³•ã€‚åœ¨è¿¹èŒƒæ•°çƒçº¦æŸä¸‹ï¼Œæ¯ä¸€æ­¥è´ªå¿ƒåœ°æ·»åŠ ä¸€ä¸ª Rank-1 åŸå­ (Top-1 å¥‡å¼‚å‘é‡)ã€‚

## ğŸ† è¯„æµ‹ç»“æœï¼ˆ5-fold RMSEï¼‰

| ç®—æ³• | fold0 | fold1 | fold2 | fold3 | fold4 | å¹³å‡ |
| --- | --- | --- | --- | --- | --- | --- |
| **nc_mf_sgd** | **0.849600** | **0.849226** | **0.852479** | **0.846997** | **0.849657** | **0.849592** |
| nc_mf_nobias | 0.994698 | 0.994905 | 0.994236 | 0.995663 | 0.996185 | 0.995138 |
| nc_alt_block | 1.008974 | 1.010255 | 1.013081 | 1.011472 | 1.011392 | 1.011035 |
| nc_spec_alt | 1.010109 | 1.011623 | 1.010568 | 1.010884 | 1.011460 | 1.010929 |
| nc_perturb | 0.961587 | 0.963892 | 0.961686 | 0.963618 | 0.965574 | 0.963271 |
| nc_pgd_rankk | 0.950953 | 0.950755 | 0.950997 | 0.951609 | 0.950161 | 0.950895 |
| **c_softimpute** | 0.918405 | 0.921495 | 0.920001 | 0.918319 | 0.919555 | 0.919555 |
| c_ista_nuc | 0.978705 | 0.978900 | 0.979133 | 0.978328 | 0.976960 | 0.978405 |
| c_fista_nuc | 2.437001 | 2.573143 | 2.576045 | 2.502314 | 2.576237 | 2.532948 |
| c_fw_trace | 1.059627 | 1.059476 | 1.060222 | 1.060281 | 1.059845 | 1.059890 |

**ç»“æœå«ä¹‰ä¸ç†è®ºæ”¯æŒ**ï¼š
- `nc_mf_sgd` æœ€ä½³ï¼šéå‡¸ MF è´´åˆä½ç§©ç»“æ„ï¼›ç»éªŒä¸ç†è®ºè¡¨æ˜åœ¨è¶³å¤Ÿç»´åº¦å’Œè‰¯å¥½åˆå§‹åŒ–ä¸‹å±€éƒ¨æå°æ¥è¿‘æœ€ä¼˜ã€‚
- `c_softimpute` æ¬¡ä¼˜ï¼šæ ¸èŒƒæ•°å‡¸æ›¿ä»£å¸¦æ¥å…¨å±€æœ€ä¼˜ä¸å»å™ªï¼Œç¨³å¥ä½†å¯èƒ½æ¬ æ‹Ÿåˆç»†èŠ‚ã€‚
- `nc_pgd_rankk`ï¼šæŠ•å½±ä¿è¯ä½ç§©å…ˆéªŒï¼Œç•¥å¼±äº MFï¼Œæš—ç¤ºæ­¥é•¿/ç§©/åˆå§‹åŒ–å¯è¿›ä¸€æ­¥è°ƒä¼˜ã€‚
- `c_fista_nuc`ï¼šRMSE å¾ˆé«˜ï¼ŒåŠ¨é‡+æ­¥é•¿æœªæ»¡è¶³ FISTA æ”¶æ•›æ¡ä»¶ï¼›å‡¸ç†è®ºä¿è¯æ”¶æ•›ï¼Œä½†éœ€ Lipschitz æ­¥é•¿æˆ–çº¿æœç´¢ã€‚

## ğŸ“‰ æ”¶æ•›æ€§ä¸å‚æ•°åˆ†æ
- **æ”¶æ•›æ€§**ï¼š`c_softimpute` å•è°ƒä¸‹é™ä¸”æœ€ä½ï¼›`nc_pgd_rankk` ç¨³å®šä¸‹é™ï¼›`c_fista_nuc` æ³¢åŠ¨ä¸”é«˜ä½ï¼ˆæ­¥é•¿é—®é¢˜ï¼‰ã€‚
- **Rank æ‰«æ**ï¼š
    - `nc_mf_sgd`ï¼šrank 10â€“20 æœ€ä½³ï¼Œè¿‡é«˜ rank è¯±å‘è¿‡æ‹Ÿåˆã€‚
    - `nc_spec_alt`ï¼šRMSE éš rank å•è°ƒä¸Šå‡ï¼Œå»ºè®®ä¿æŒè¾ƒä½ rankã€‚

---

# Part 2: ML-20M æ•°æ®é›†ä¼˜åŒ–å®éªŒåˆ†æ

## é¡¹ç›®æ¦‚è¿°
æœ¬é¡¹ç›®é’ˆå¯¹ ML-20M å¤§è§„æ¨¡æ¨èç³»ç»Ÿæ•°æ®é›†ï¼ŒåŸºäºä½ç§©çŸ©é˜µåˆ†è§£ï¼ˆLowRankSVDï¼‰å®ç° GPU åŠ é€Ÿçš„äº¤å‰éªŒè¯å®éªŒï¼Œæ ¸å¿ƒåˆ†æç®—æ³•æ”¶æ•›æ€§ã€è¶…å‚æ•°ï¼ˆå­¦ä¹ ç‡/æ­£åˆ™åŒ–ï¼‰å½±å“ã€ç§©ä¸ RMSE å…³ç³»ç­‰å…³é”®ç»´åº¦ï¼ŒéªŒè¯ `nc_mf_sgd` æ–¹æ³•åœ¨å¤§è§„æ¨¡æ•°æ®é›†ä¸Šçš„æ€§èƒ½ã€‚

## å®éªŒç¯å¢ƒä¸æ ¸å¿ƒé…ç½®
### ç¡¬ä»¶/è½¯ä»¶ç¯å¢ƒ
- è®¡ç®—èµ„æºï¼šGPUï¼ˆCUDA åŠ é€Ÿï¼‰
- æ ¸å¿ƒä¾èµ–ï¼šPyTorchï¼ˆå¼ é‡è®¡ç®—ï¼‰ã€NumPyï¼ˆç»Ÿè®¡åˆ†æï¼‰
- æ•°æ®é›†ï¼šML-20Mï¼ˆ138493 ç”¨æˆ· + 26744 ç‰©å“ï¼‰

### æ ¸å¿ƒå®éªŒå‚æ•°
| å‚æ•°ç±»åˆ« | å–å€¼ |
| --- | --- |
| äº¤å‰éªŒè¯æŠ˜æ•° | 5 æŠ˜ |
| æ‰¹æ¬¡å¤§å° | 131072 |
| MF æ¨¡å‹ç§©ï¼ˆrank_mfï¼‰ | 64 |
| è®­ç»ƒè½®æ•°ï¼ˆepochs_mfï¼‰ | 4 |
| å­¦ä¹ ç‡ï¼ˆlr_mfï¼‰ | 0.01 |
| æ­£åˆ™åŒ–ç³»æ•° | reg_mf=0.02ã€reg_bias=0.005 |

## æ ¸å¿ƒæ–¹æ³•ï¼šLowRankSVD ä½ç§©é¢„æµ‹å™¨
æœ¬å®éªŒçš„æ ¸å¿ƒé¢„æµ‹é€»è¾‘åŸºäºä½ç§©çŸ©é˜µåˆ†è§£å®ç°ï¼Œ`LowRankSVD` ç±»é€šè¿‡ç”¨æˆ·/ç‰©å“åµŒå…¥çŸ©é˜µä¸å¥‡å¼‚å€¼åŠ æƒï¼Œå®Œæˆè¯„åˆ†é¢„æµ‹ï¼š
```python
@dataclass
class LowRankSVD(Predictor):
    U: torch.Tensor   # (n_users,r)  ç”¨æˆ·åµŒå…¥çŸ©é˜µ
    S: torch.Tensor   # (r,)         å¥‡å¼‚å€¼å‘é‡
    V: torch.Tensor   # (n_items,r)  ç‰©å“åµŒå…¥çŸ©é˜µ
    mu: float = 0.0   # å…¨å±€è¯„åˆ†å‡å€¼

    def predict(self, u: torch.Tensor, i: torch.Tensor) -> torch.Tensor:
        # é¢„æµ‹å…¬å¼ï¼šmu + sum_k U[u,k]*S[k]*V[i,k]
        return self.mu + (self.U[u] * self.S.unsqueeze(0) * self.V[i]).sum(dim=-1)
